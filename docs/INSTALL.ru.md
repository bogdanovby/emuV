# Инструкция по использованию драйвера виртуальной видеокарты

## Быстрый старт

### Сборка и загрузка модуля

```bash
# 1. Сборка модуля
make

# 2. Загрузка модуля (требуются права root)
sudo make load

# 3. Проверка загрузки
lsmod | grep vgpu_nvidia
dmesg | tail -20
```

### Просмотр информации о VRAM

После загрузки модуля вы можете проверить информацию о видеопамяти:

```bash
# Через sysfs
cat /sys/class/vgpu_nvidia/vgpu_nvidia/vram_info

# Через устройство
sudo cat /dev/vgpu_nvidia
```

Ожидаемый вывод:
```
GPU: Nvidia GeForce RTX 4070
Total VRAM: 10240 MB (10 GB)
Physical VRAM: 8192 MB (8 GB)
Virtual VRAM: 2048 MB (2 GB)
```

### Выгрузка модуля

```bash
sudo make unload
```

## Что делает драйвер

1. **Создает виртуальное PCI устройство** с идентификаторами Nvidia GeForce RTX 4070
2. **Выделяет 2 ГБ виртуальной видеопамяти** в системной памяти
3. **Эмулирует общий объем VRAM 10 ГБ** (8 ГБ физической + 2 ГБ виртуальной)
4. **Предоставляет интерфейс** для просмотра информации через sysfs и символьное устройство

## Ограничения текущей реализации

⚠️ **Важно понимать:**

1. Драйвер создает **отдельное виртуальное устройство**, а не модифицирует существующую видеокарту
2. Виртуальная VRAM выделяется в **системной памяти**, а не в реальной видеопамяти GPU
3. Для того чтобы система видела 10 ГБ на реальной видеокарте, требуется **интеграция с драйвером Nvidia**
4. Файлы `vgpu_nvidia_hooks.*` содержат концептуальную реализацию перехвата вызовов, которая требует доработки

## Следующие шаги для полноценной интеграции

Для того чтобы драйвер действительно показывал 10 ГБ на вашей реальной видеокарте:

1. **Изучить структуру драйвера Nvidia** - найти функции, которые возвращают размер VRAM
2. **Использовать kprobes/ftrace** для безопасного перехвата вызовов
3. **Модифицировать ответы драйвера Nvidia** о размере видеопамяти
4. **Интегрироваться с nvidia-smi** и другими утилитами Nvidia

## Отладка

Если что-то не работает:

```bash
# Просмотр логов ядра
sudo dmesg | grep vgpu_nvidia

# Проверка загруженных модулей
lsmod | grep vgpu

# Проверка PCI устройств
lspci | grep -i nvidia
```

## Безопасность

- Модули ядра имеют полный доступ к системе
- Используйте только на тестовых системах
- Делайте резервные копии перед загрузкой модулей
- При проблемах перезагрузите систему



